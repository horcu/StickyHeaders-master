{"Id":"3fa96657-665b-49ff-8691-f533137ee706","Topic":"Ch 07. Object-Oriented Design","Question":"","Solution":"package Q7_07_Chat_Server;\r\n\r\nimport java.util.Date;\r\nimport java.util.HashMap;\r\n\r\n/* UserManager serves as the central place for the core user actions. */\r\npublic class UserManager {\r\n\tprivate static UserManager instance;\r\n\tprivate HashMap<Integer, User> usersById = new HashMap<Integer, User>();\r\n\tprivate HashMap<String, User> usersByAccountName = new HashMap<String, User>();\r\n\tprivate HashMap<Integer, User> onlineUsers = new HashMap<Integer, User>();\r\n\t\r\n\tpublic static UserManager getInstance() {\r\n\t\tif (instance == null) {\r\n\t\t\tinstance = new UserManager();\r\n\t\t}\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\tpublic void addUser(User fromUser, String toAccountName) {\r\n\t\tUser toUser = usersByAccountName.get(toAccountName);\r\n\t\tAddRequest req = new AddRequest(fromUser, toUser, new Date());\r\n\t\ttoUser.receivedAddRequest(req);\r\n\t\tfromUser.sentAddRequest(req);\r\n\t}\r\n\t\r\n\tpublic void approveAddRequest(AddRequest req) {\r\n\t\treq.status = RequestStatus.Accepted;\r\n\t\tUser from = req.getFromUser();\r\n\t\tUser to = req.getToUser();\r\n\t\tfrom.addContact(to);\r\n\t\tto.addContact(from);\r\n\t}\r\n\t\r\n\tpublic void rejectAddRequest(AddRequest req) {\r\n\t\treq.status = RequestStatus.Rejected;\r\n\t\tUser from = req.getFromUser();\r\n\t\tUser to = req.getToUser();\r\n\t\tfrom.removeAddRequest(req);\r\n\t\tto.removeAddRequest(req);\t\t\r\n\t}\r\n\t\r\n\tpublic void userSignedOn(String accountName) {\r\n\t\tUser user = usersByAccountName.get(accountName);\r\n\t\tif (user != null) {\r\n\t\t\tuser.setStatus(new UserStatus(UserStatusType.Available, \"\"));\t\t\t\r\n\t\t\tonlineUsers.put(user.getId(), user);\r\n\t\t}\r\n\t}\r\n\t\r\n\tpublic void userSignedOff(String accountName) {\r\n\t\tUser user = usersByAccountName.get(accountName);\r\n\t\tif (user != null) {\r\n\t\t\tuser.setStatus(new UserStatus(UserStatusType.Offline, \"\"));\r\n\t\t\tonlineUsers.remove(user.getId());\r\n\t\t}\r\n\t}\t\r\n}\r\n\r\n","Chapter":"Ch 07. Object-Oriented Design"}